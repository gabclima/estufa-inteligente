import { APP_PATHS } from "../constants";

export function automations(controllerId) {

  const mockList = [
    {
      id: new Date().getTime(),
      label: "Ligar irrigação - umidade do solo",
      state: "on"
    },
    {
      id: new Date().getTime() + 1,
      label: "Desligar irrigação - umidade do solo",
      state: "on"
    },
    {
      id: new Date().getTime() + 2,
      label: "Automação 3",
      state: "on"
    },
    {
      id: new Date().getTime() + 3,
      label: "Automação 4",
      state: "off"
    }
  ];

  // let automationsList = [];
  let automationsList = mockList;

  function groupAutomationsByState(list) {
    const active = [];
    const inactive = [];

    list.forEach(automation => {
      if (automation.state === "on") {
        active.push(automation);
        return;
      }

      inactive.push(automation);
    });

    return { active, inactive };
  }

  function automationItem(automation) {
    return `
      <li class="flex items-center gap-4 bg-input rounded-md p-3">
        <label for="automation-state-${automation.id}" class="relative inline-flex items-center cursor-pointer gap-3">
          <input id="automation-state-${automation.id}" type="checkbox" class="sr-only peer" ${automation.state === "on" ? "checked" : ""}/>
          <div class="w-12 min-w-12 h-[1.625rem] bg-label rounded-full peer peer-checked:bg-toggle-input relative 
                after:content-[''] after:absolute after:top-1 after:left-1 
                after:bg-white after:border-gray-300 after:border after:rounded-full
                after:h-[1.125rem] after:w-[1.125rem] after:transition-all peer-checked:after:translate-x-full peer-checked:after:left-2">
          </div>
          <h3 class="text-label font-semibold text-base">${automation.label}</h3>
        </label>
        <a href="${window.location.pathname}/automations/${automation.id}" class="ml-auto text-label">
          <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M13.6643 0.164157C13.7165 0.111773 13.7786 0.0702125 13.8469 0.0418553C13.9153 0.013498 13.9885 -0.00109863 14.0625 -0.00109863C14.1365 -0.00109863 14.2098 0.013498 14.2781 0.0418553C14.3465 0.0702125 14.4085 0.111773 14.4608 0.164157L17.8358 3.53916C17.8882 3.59141 17.9297 3.65348 17.9581 3.72182C17.9864 3.79016 18.001 3.86342 18.001 3.93741C18.001 4.01139 17.9864 4.08466 17.9581 4.15299C17.9297 4.22133 17.8882 4.28341 17.8358 4.33566L6.58578 15.5857C6.53179 15.6393 6.4675 15.6814 6.39678 15.7094L0.771776 17.9594C0.669554 18.0003 0.557571 18.0103 0.44971 17.9882C0.34185 17.9661 0.242854 17.9128 0.164997 17.8349C0.0871395 17.7571 0.0338443 17.6581 0.0117184 17.5502C-0.0104075 17.4424 -0.000391027 17.3304 0.040526 17.2282L2.29053 11.6032C2.31857 11.5324 2.36067 11.4681 2.41428 11.4142L13.6643 0.164157ZM12.6079 2.81241L15.1875 5.39203L16.6422 3.93741L14.0625 1.35778L12.6079 2.81241ZM14.3922 6.18741L11.8125 3.60778L4.50003 10.9203V11.2499H5.06253C5.21171 11.2499 5.35478 11.3092 5.46027 11.4147C5.56576 11.5201 5.62503 11.6632 5.62503 11.8124V12.3749H6.18753C6.33671 12.3749 6.47978 12.4342 6.58527 12.5397C6.69076 12.6451 6.75003 12.7882 6.75003 12.9374V13.4999H7.07965L14.3922 6.18741ZM3.41103 12.0093L3.29178 12.1285L1.57278 16.4272L5.8714 14.7082L5.99065 14.5889C5.88335 14.5488 5.79084 14.4769 5.7255 14.3828C5.66017 14.2887 5.62511 14.177 5.62503 14.0624V13.4999H5.06253C4.91334 13.4999 4.77027 13.4406 4.66478 13.3352C4.55929 13.2297 4.50003 13.0866 4.50003 12.9374V12.3749H3.93753C3.82298 12.3748 3.71119 12.3398 3.6171 12.2744C3.52301 12.2091 3.45112 12.1166 3.41103 12.0093Z" fill="currentColor"/>
          </svg>
        </a>
      </li>
    `;
  }

  function renderAutomationsList(list) {
    const groupedAutomations = groupAutomationsByState(list);
    const activeAutomations = groupedAutomations.active;
    const inactiveAutomations = groupedAutomations.inactive;

    return [activeAutomations, inactiveAutomations].map((automations, index) => (automations.length === 0 ? "" : `
      <h3 class="text-title font-semibold text-xl mt-4">
        ${index === 0 ? "Ativas" : "Inativas"}
      </h3>
      <ul id="automations-list" class="flex flex-col gap-2 mt-4">
        ${automations.map(automation => automationItem(automation)).join("")}
      </ul>
    `)).join("");
  }

  const html = /*html*/ `
    <div class="flex justify-between gap-2 items-center">
      <div class="flex items-center gap-4">
        <nav class="ml-[-0.625rem]">
          <a href="${APP_PATHS.CONTROLLERS}" class="text-light">
            <svg width="20" height="15" viewBox="0 0 20 15" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M20 7.5C20 7.21589 19.8903 6.94342 19.6949 6.74252C19.4996 6.54163 19.2347 6.42876 18.9584 6.42876H9.59159H3.55778L8.03028 1.83102C8.12712 1.73142 8.20394 1.61318 8.25635 1.48305C8.30876 1.35292 8.33573 1.21344 8.33573 1.07259C8.33573 0.931735 8.30876 0.792258 8.25635 0.662126C8.20394 0.531993 8.12712 0.413753 8.03028 0.314154C7.93344 0.214555 7.81847 0.135548 7.69194 0.081645C7.56542 0.0277424 7.4298 0 7.29285 0C7.1559 0 7.02028 0.0277424 6.89375 0.081645C6.76723 0.135548 6.65226 0.214555 6.55542 0.314154L0.306 6.74156C0.209002 6.84107 0.132045 6.95929 0.0795365 7.08943C0.0270279 7.21958 0 7.3591 0 7.5C0 7.6409 0.0270279 7.78042 0.0795365 7.91057C0.132045 8.04071 0.209002 8.15893 0.306 8.25843L6.55542 14.6858C6.751 14.887 7.01626 15 7.29285 15C7.56944 15 7.8347 14.887 8.03028 14.6858C8.22586 14.4847 8.33573 14.2119 8.33573 13.9274C8.33573 13.6429 8.22586 13.3701 8.03028 13.169L3.55778 8.57124H18.9584C19.2347 8.57124 19.4996 8.45837 19.6949 8.25748C19.8903 8.05658 20 7.78411 20 7.5Z" fill="currentColor"/>
            </svg>
          </a>
        </nav>
        <h1 class="text-light font-semibold text-xl leading-none">
          Automações
        </h1>
      </div>
      <ul class="flex gap-6 items-center">
        <li>
          <a href="${window.location.pathname}/automations/new" class="text-light p-2 block rounded-full hover:bg-light hover:text-dark transition-colors">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M8 0C8.26522 0 8.51957 0.105357 8.70711 0.292893C8.89464 0.48043 9 0.734784 9 1V7H15C15.2652 7 15.5196 7.10536 15.7071 7.29289C15.8946 7.48043 16 7.73478 16 8C16 8.26522 15.8946 8.51957 15.7071 8.70711C15.5196 8.89464 15.2652 9 15 9H9V15C9 15.2652 8.89464 15.5196 8.70711 15.7071C8.51957 15.8946 8.26522 16 8 16C7.73478 16 7.48043 15.8946 7.29289 15.7071C7.10536 15.5196 7 15.2652 7 15V9H1C0.734784 9 0.48043 8.89464 0.292893 8.70711C0.105357 8.51957 0 8.26522 0 8C0 7.73478 0.105357 7.48043 0.292893 7.29289C0.48043 7.10536 0.734784 7 1 7H7V1C7 0.734784 7.10536 0.48043 7.29289 0.292893C7.48043 0.105357 7.73478 0 8 0Z" fill="currentColor"/>
            </svg>
          </a>
        </li>
        <li>
          <a href="#" class="text-light flex">
            <span class="inline-block origin-top hover:animate-[bell-wiggle_0.7s_ease-in-out] will-change-transform">
              <svg width="19" height="22" viewBox="0 0 19 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M9.5 22C10.1962 22 10.8639 21.7103 11.3562 21.1946C11.8484 20.6788 12.125 19.9794 12.125 19.25H6.875C6.875 19.9794 7.15156 20.6788 7.64384 21.1946C8.13613 21.7103 8.80381 22 9.5 22ZM9.5 2.63726L8.45394 2.85864C7.26716 3.11143 6.2003 3.78629 5.43414 4.76886C4.66798 5.75143 4.24964 6.98128 4.25 8.25001C4.25 9.11351 4.07412 11.2709 3.64756 13.3953C3.43756 14.4499 3.15406 15.5485 2.77737 16.5H16.2226C15.8459 15.5485 15.5637 14.4513 15.3524 13.3953C14.9259 11.2709 14.75 9.11351 14.75 8.25001C14.7501 6.98152 14.3316 5.75199 13.5654 4.7697C12.7993 3.78742 11.7326 3.11276 10.5461 2.86001L9.5 2.63726ZM17.6637 16.5C17.9564 17.1146 18.2951 17.6014 18.6875 17.875H0.3125C0.704937 17.6014 1.04356 17.1146 1.33625 16.5C2.5175 14.025 2.9375 9.46001 2.9375 8.25001C2.9375 4.92251 5.195 2.14501 8.19406 1.51114C8.17574 1.31995 8.19588 1.12686 8.25317 0.944326C8.31046 0.761791 8.40363 0.593861 8.52668 0.451368C8.64973 0.308874 8.79992 0.19498 8.96756 0.117032C9.13521 0.0390828 9.31658 -0.00119019 9.5 -0.00119019C9.68342 -0.00119019 9.86479 0.0390828 10.0324 0.117032C10.2001 0.19498 10.3503 0.308874 10.4733 0.451368C10.5964 0.593861 10.6895 0.761791 10.7468 0.944326C10.8041 1.12686 10.8243 1.31995 10.8059 1.51114C12.2897 1.82677 13.6236 2.67015 14.5816 3.89832C15.5396 5.12649 16.0628 6.66392 16.0625 8.25001C16.0625 9.46001 16.4825 14.025 17.6637 16.5Z" fill="currentColor"/>
              </svg>
            </span>
          </a>
        </li>
      </ul>
    </div>
    <form>
      <div class="flex flex-col mt-4">
        <div class="rounded-md bg-search-input flex items-center justify-start gap-2 px-3 py-3 text-label">
          <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M13.2099 11.6367C14.2992 10.1502 14.7871 8.30727 14.576 6.47651C14.3649 4.64575 13.4702 2.96222 12.0711 1.76274C10.672 0.563252 8.87162 -0.0637297 7.0301 0.00722763C5.18857 0.0781849 3.44174 0.841849 2.13908 2.14544C0.836426 3.44903 0.0740124 5.1964 0.00437286 7.03798C-0.0652667 8.87956 0.563003 10.6795 1.76349 12.0778C2.96397 13.476 4.64814 14.3694 6.47905 14.5793C8.30996 14.7891 10.1526 14.2999 11.6383 13.2095C11.6713 13.2545 11.7069 13.2976 11.7474 13.3388L16.0787 17.6701C16.2896 17.8812 16.5758 17.9998 16.8742 17.9999C17.1726 18 17.4589 17.8816 17.67 17.6707C17.8811 17.4597 17.9997 17.1735 17.9998 16.8751C17.9999 16.5767 17.8815 16.2904 17.6705 16.0793L13.3393 11.7481C13.2991 11.7074 13.2558 11.6709 13.2099 11.6367ZM13.5002 7.31222C13.5002 8.12477 13.3401 8.92937 13.0292 9.68007C12.7182 10.4308 12.2624 11.1129 11.6879 11.6874C11.1133 12.262 10.4312 12.7178 9.68051 13.0287C8.92981 13.3397 8.12521 13.4997 7.31266 13.4997C6.5001 13.4997 5.6955 13.3397 4.9448 13.0287C4.1941 12.7178 3.51199 12.262 2.93743 11.6874C2.36287 11.1129 1.9071 10.4308 1.59615 9.68007C1.2852 8.92937 1.12516 8.12477 1.12516 7.31222C1.12516 5.67119 1.77705 4.09737 2.93743 2.93699C4.09781 1.77661 5.67163 1.12472 7.31266 1.12472C8.95368 1.12472 10.5275 1.77661 11.6879 2.93699C12.8483 4.09737 13.5002 5.67119 13.5002 7.31222Z" fill="currentColor"/>
          </svg>
          <input 
            id="query" 
            type="text" 
            name="query" 
            placeholder="Pesquisar" 
            class="placeholder:text-placeholder flex-1 outline-0 text-light text-sm"
          />
        </div>
      </div>
    </form>
    ${automationsList.length === 0 ? /*html*/ `
      <div class="flex gap-4 justify-between mt-4">
        <svg width="107" height="109" viewBox="0 0 107 109" fill="none" xmlns="http://www.w3.org/2000/svg">
          <g opacity="0.25"><path d="M75.8626 30.0426C64.4561 33.0375 60.4918 42.8583 61.1511 46.9624C61.3602 46.8362 61.5648 46.7145 61.7762 46.5828C62.7785 45.9678 63.8696 45.386 65.0016 44.786C66.1267 44.1824 67.3385 43.6221 68.5588 43.0539C69.1726 42.7676 69.816 42.5162 70.4525 42.2571L71.4118 41.8661C71.8255 41.7035 72.0801 41.6366 72.4212 41.5172L74.3442 40.8774C75.0127 40.6866 75.6763 40.5001 76.3333 40.3136C77.663 39.9465 78.9474 39.6226 80.1976 39.3646C82.6957 38.7964 85.0439 38.3828 87.0645 38.0701C91.1108 37.454 93.868 37.337 93.868 37.337C93.868 37.337 93.2384 37.6076 92.1335 38.0791C91.0243 38.5406 89.4423 39.1521 87.5373 39.884C86.578 40.2328 85.5485 40.6124 84.4574 41.0125C83.3641 41.4012 82.2092 41.8081 81.0183 42.2297C79.8384 42.6457 78.627 43.0798 77.3882 43.5219C76.1766 43.9311 74.9126 44.4152 73.6444 44.9016C72.4624 45.3437 71.2349 45.9326 70.0303 46.4099C68.8347 46.9542 66.7843 47.667 65.6251 48.1625C64.227 48.749 63.3426 49.0661 62.454 49.5366C52.5036 55.3432 48.0949 65.6222 45.4058 76.499C44.9285 66.2813 42.7848 56.3683 35.4087 49.0569C35.4155 49.0525 35.4256 49.0501 35.4326 49.0445C34.379 48.0576 33.3438 47.0512 32.3275 46.0258C31.4502 45.1212 30.5228 44.2221 29.6203 43.263C28.6941 42.3605 27.7837 41.3502 26.8552 40.4886C25.8653 39.5533 24.8879 38.6271 23.9218 37.7815C22.9465 36.9062 21.9931 36.0425 21.0633 35.2049C20.1212 34.3604 19.2107 33.5456 18.3493 32.7681C17.4957 31.9815 16.6809 31.2359 15.9365 30.5472C14.4534 29.1481 13.2202 27.9753 12.3745 27.125C11.5367 26.2669 11.0594 25.776 11.0594 25.776C11.0594 25.776 13.5599 26.9375 17.0652 29.0504C18.813 30.1119 20.8237 31.3895 22.9195 32.8681C23.9753 33.5876 25.0391 34.3764 26.1267 35.2208C26.6621 35.647 27.2063 36.0709 27.7463 36.4994L29.2807 37.8256C29.5501 38.0678 29.7603 38.2233 30.0786 38.5336L30.8197 39.2623C31.3129 39.7464 31.8086 40.226 32.2643 40.7216C33.1837 41.7105 34.0826 42.6936 34.8953 43.6801C35.7114 44.6667 36.4968 45.6213 37.1877 46.5717C37.3343 46.7763 37.4719 46.9625 37.6185 47.1603C39.7995 43.62 39.8847 33.0284 30.4821 25.9033C20.243 18.152 5.9748 21.6299 0 18.7623C6.03281 27.9911 4.87456 34.1523 15.0093 44.2801C21.782 51.0561 28.107 51.4756 32.3678 50.2969C41.034 58.6392 42.3866 71.3572 42.391 83.5275C41.5045 82.8092 40.4271 82.2455 39.1838 82.2455C35.6763 82.2455 33.1223 84.2184 31.8983 87.0326C24.1778 84.4048 19.0497 90.5126 18.6053 95.6568C14.932 94.2906 10.272 98.5162 10.272 102.188C10.272 105.813 13.1372 108.747 16.7264 108.9L73.5574 109C73.5574 109 79.6128 105.736 79.6128 102.185C79.6128 98.4642 76.5965 95.443 72.8755 95.443C72.3594 95.443 71.866 95.5112 71.3889 95.6202C71.4206 95.3589 70.7387 83.9161 60.7961 88.5122C60.0232 84.932 59.0094 82.2455 53.0358 82.2455C50.0933 82.2455 48.1007 83.3138 46.8257 84.4002C49.3136 71.7434 53.1586 58.5209 64.365 51.9802C64.4878 51.9109 64.5515 51.8176 64.6377 51.7335C68.102 54.5124 74.1575 56.6593 83.1453 52.9268C96.3748 47.4317 97.6546 41.2965 106.754 35.0715C100.144 35.4424 88.2827 26.783 75.8626 30.0426ZM44.8915 86.5304L45.2631 86.1576C45.0756 86.4486 44.9608 86.66 44.9608 86.66C44.9608 86.66 44.9232 86.5872 44.8915 86.5304Z" fill="#56FF95"/></g>
          <g opacity="0.25"><path d="M51.7824 26.9617C50.6033 27.7799 48.7075 27.3421 48.2971 25.6457C48.2138 25.302 48.0505 24.9828 47.8206 24.7141C47.5906 24.4454 47.3005 24.2348 46.9737 24.0995C46.647 23.9641 46.2929 23.9078 45.9403 23.9351C45.5877 23.9625 45.2466 24.0727 44.9446 24.2568C42.9342 25.4815 40.6319 23.1806 41.8566 21.1688C42.0405 20.867 42.1505 20.526 42.1778 20.1737C42.2051 19.8213 42.1488 19.4675 42.0136 19.141C41.8784 18.8144 41.6681 18.5244 41.3997 18.2945C41.1313 18.0645 40.8124 17.9012 40.469 17.8177C38.1811 17.2626 38.1811 14.0079 40.469 13.4528C40.8127 13.3695 41.1319 13.2063 41.4006 12.9763C41.6693 12.7464 41.8799 12.4562 42.0153 12.1295C42.1506 11.8028 42.2069 11.4487 42.1796 11.0961C42.1523 10.7435 42.0421 10.4023 41.858 10.1004C40.6332 8.08994 42.9342 5.78765 44.9459 7.01241C46.2488 7.8046 47.9375 7.10362 48.2971 5.62478C48.8521 3.33682 52.1069 3.33682 52.6619 5.62478C52.7452 5.9685 52.9084 6.28769 53.1384 6.55638C53.3684 6.82507 53.6585 7.03567 53.9852 7.17104C54.312 7.3064 54.666 7.36271 55.0186 7.33537C55.3712 7.30803 55.7124 7.19782 56.0144 7.01371C58.0248 5.78895 60.3271 8.08994 59.1023 10.1017C58.9185 10.4035 58.8084 10.7445 58.7812 11.0968C58.7539 11.4492 58.8102 11.803 58.9454 12.1295C59.0806 12.4561 59.2909 12.7461 59.5593 12.976C59.8277 13.206 60.1465 13.3693 60.49 13.4528C62.4339 13.9245 62.7258 16.344 61.3681 17.4007" stroke="#56FF95" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M46.5707 15.6353C46.5707 16.6719 46.9825 17.6662 47.7155 18.3992C48.4486 19.1322 49.4428 19.5441 50.4795 19.5441C51.5162 19.5441 52.5104 19.1322 53.2434 18.3992C53.9765 17.6662 54.3883 16.6719 54.3883 15.6353C54.3883 14.5986 53.9765 13.6043 53.2434 12.8713C52.5104 12.1383 51.5162 11.7264 50.4795 11.7264C49.4428 11.7264 48.4486 12.1383 47.7155 12.8713C46.9825 13.6043 46.5707 14.5986 46.5707 15.6353Z" stroke="#56FF95" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M56.9941 28.6646L63.5088 24.7558L56.9941 20.847V28.6646Z" stroke="#56FF95" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></g>
        </svg>
        <div class="flex flex-col items-end pr-12">
          <svg width="18" height="27" viewBox="0 0 18 27" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M9 27C9.26518 27 9.5195 26.8984 9.70701 26.7176C9.89452 26.5368 9.99986 26.2915 9.99986 26.0358V3.29359L16.291 9.36241C16.4787 9.54347 16.7334 9.64518 16.9989 9.64518C17.2644 9.64518 17.519 9.54347 17.7068 9.36241C17.8945 9.18136 18 8.93579 18 8.67974C18 8.42369 17.8945 8.17813 17.7068 7.99707L9.7079 0.283277C9.61502 0.193482 9.50469 0.12224 9.38321 0.0736306C9.26174 0.0250212 9.13152 0 9 0C8.86848 0 8.73826 0.0250212 8.61679 0.0736306C8.49531 0.12224 8.38498 0.193482 8.2921 0.283277L0.293222 7.99707C0.200259 8.08672 0.126517 8.19315 0.076206 8.31028C0.0258949 8.42741 0 8.55296 0 8.67974C0 8.93579 0.105475 9.18136 0.293222 9.36241C0.480969 9.54347 0.735608 9.64518 1.00112 9.64518C1.26664 9.64518 1.52128 9.54347 1.70902 9.36241L8.00014 3.29359V26.0358C8.00014 26.2915 8.10548 26.5368 8.29299 26.7176C8.4805 26.8984 8.73482 27 9 27Z" fill="#747775"/>
          </svg>
          <p class="font-normal text-lg text-label">Crie sua primeira automação</p>
        </div>
      </div>
    `: `<section id="automations-wrapper">${renderAutomationsList(automationsList)}</section>`
}
`;

  function updateAutomationsList(newlist) {
    const automationsWrapper = document.getElementById("automations-wrapper");
    if (!automationsWrapper) return;

    automationsList = newlist;
    automationsWrapper.innerHTML = renderAutomationsList(newlist);
    setAutomationsControls();
  }

  function setAutomationsControls() {
    const controls = document.querySelectorAll("#automations-list input[type=\"checkbox\"]");
    controls.forEach(control => {
      control.addEventListener("click", () => {
        const newAutomationList = automationsList.map(automation => {
          if (control.id.endsWith(automation.id)) {
            return {
              ...automation,
              state: control.checked ? "on" : "off"
            };
          }
          return automation;
        });

        updateAutomationsList(newAutomationList);
      });
    });
  }

  function execute() {
    setAutomationsControls();
  }

  return {
    html,
    execute
  };
}